<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      M.C. Shih &middot; Quirky
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/blog/public/css/poole.css">
  <link rel="stylesheet" href="/blog/public/css/syntax.css">
  <link rel="stylesheet" href="/blog/public/css/hyde.css">
  <link rel="stylesheet" href="/blog/public/css/custom.css">
  <link rel="stylesheet" href="/blog/public/css/fontawesome-all.css">
  <!-- <link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css" rel="stylesheet"> -->
  <!--<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"> -->

  <!-- Icons -->
  <link rel="apple-touch-icon" sizes="16x16" href="/blog/public/apple-touch-icon-16-precomposed.png">
  <link rel="apple-touch-icon" sizes="24x24" href="/blog/public/apple-touch-icon-24-precomposed.png">
  <link rel="apple-touch-icon" sizes="32x32" href="/blog/public/apple-touch-icon-32-precomposed.png">
  <link rel="apple-touch-icon" sizes="48x48" href="/blog/public/apple-touch-icon-48-precomposed.png">
  <link rel="apple-touch-icon" sizes="57x57" href="/blog/public/apple-touch-icon-57-precomposed.png">
  <link rel="apple-touch-icon" sizes="64x64" href="/blog/public/apple-touch-icon-64-precomposed.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/blog/public/apple-touch-icon-72-precomposed.png"> 
  <link rel="apple-touch-icon" sizes="114x114" href="/blog/public/apple-touch-icon-114-precomposed.png"> 
  <link rel="apple-touch-icon" sizes="120x120" href="/blog/public/apple-touch-icon-120-precomposed.png"> 
  <link rel="apple-touch-icon" sizes="144x144" href="/blog/public/apple-touch-icon-144-precomposed.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/blog/public/apple-touch-icon-152-precomposed.png">
  <link rel="apple-touch-icon" sizes="512x512" href="/blog/public/apple-touch-icon-512-precomposed.png">
  <link rel="shortcut icon" href="/blog/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/blog/">
          M.C. Shih
        </a>
      </h1>
      <p class="lead">I share some stuff.</p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item active" href="/blog/">Home</a>

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="/blog/about/">About</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="/blog/archive/">Archives</a>
          
        
      
        
      
        
          
        
      
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

      <!-- <a class="sidebar-nav-item" href="https://github.com/shihs/blog/archive/v2.1.0.zip">Download</a>
      <a class="sidebar-nav-item" href="https://github.com/shihs/blog">GitHub project</a> -->
      <span class="sidebar-nav-item">Currently v2.1.0</span>
    </nav>

    <p class = "rights">&copy; 2018. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/blog/2018/02/26/R-%E5%A6%82%E4%BD%95%E8%AE%80%E5%8F%96Excel%E6%AA%94%E6%A1%88/">
        [R]如何讀取Excel檔案
      </a>
    </h1>

    <span class="post-date">Posted by Shihs on February 26, 2018</span>
    <!-- <p>很多資料會使用excel檔案儲存，<br />
這邊介紹主要三種常用的附檔名。<br /></p>
<ol>
  <li>csv</li>
  <li>xlsx</li>
  <li>xls</li>
</ol>

<h2 id="1csv"><strong>1.csv</strong><br /></h2>
<p>csv是最簡單的，不需要install任何package，<strong>read.csv</strong></p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"file.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> 
</span></code></pre></div></div>
<p>假如很不幸，上面的程式碼讀取後你碰到長得像這樣的錯誤訊息</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error in type.convert(data[[i]], as.is = as.is[i], dec = dec, numerals = numerals,  : invalid multibyte string at '&lt;e8&gt;&lt;8a&gt;&lt;b1&gt;?&lt;ae&gt;'
</code></pre></div></div>
<p>那就是碰上了<a href="https://shihs.github.io/blog/2018/01/17/R-read.csv%E5%87%BA%E7%8F%BE%E7%B7%A8%E7%A2%BC%E9%8C%AF%E8%AA%A4%E8%A8%8A%E6%81%AF/">編碼錯誤</a>，<br />
這時候別緊張，只要加上<strong>fileEncoding</strong>這個參數就好，<br /></p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"file.csv"</span><span class="p">),</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">fileEncoding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"UTF-8"</span><span class="p">)</span><span class="w"> 
</span></code></pre></div></div>
<p>問題應該就可以被解決了。<br /></p>

<h2 id="2xlsx"><strong>2.xlsx</strong><br /></h2>
<p>讀取xlsx檔案時依據情況，有兩個套件我會使用，<br /></p>
<ul>
  <li><a href="https://cran.r-project.org/web/packages/openxlsx/openxlsx.pdf">openxlsx</a><br /></li>
  <li><a href="https://cran.r-project.org/web/packages/XLConnect/XLConnect.pdf">XLConnect</a><br /></li>
</ul>

<p>這兩個套件都可以儲存多個sheet，<br />
對儲存格做顏色、合併、篩選等等一般可以做的事都可以用程式碼去做。</p>

<h3 id="1openxlsx"><strong>(1)openxlsx</strong></h3>

<p><em>讀檔</em></p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">openxlsx</span><span class="p">)</span><span class="w">

</span><span class="c1"># 可以使用sheet參數選擇要的sheet，預設是第一個sheet</span><span class="w">
</span><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.xlsx</span><span class="p">(</span><span class="s2">"file.xlsx"</span><span class="p">,</span><span class="w"> </span><span class="n">sheet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sheetName</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><em>寫檔</em></p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">openxlsx</span><span class="p">)</span><span class="w">

</span><span class="c1">### 整個xlsx只有一張sheet寫檔可以簡單的使用write.xlsx就好</span><span class="w">
</span><span class="n">write.xlsx</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"file.xlsx"</span><span class="p">)</span><span class="w">


</span><span class="c1">### 有多個sheet要寫入檔案，或是要調整sheet的style</span><span class="w">
</span><span class="n">wb</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">createWorkbook</span><span class="p">()</span><span class="w">

</span><span class="c1"># 增加sheet</span><span class="w">
</span><span class="n">addWorksheet</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="w"> </span><span class="s2">"sheetName"</span><span class="p">)</span><span class="w">

</span><span class="c1"># 設定欄位寬度</span><span class="w">
</span><span class="n">setColWidths</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="w"> </span><span class="n">sheet</span><span class="p">,</span><span class="w"> </span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">widths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="nf">rep</span><span class="p">(</span><span class="m">25</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="m">30</span><span class="p">))</span><span class="w">

</span><span class="c1"># 增加style</span><span class="w">
</span><span class="n">headerStyle</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">createStyle</span><span class="p">(</span><span class="n">fgFill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yellow"</span><span class="p">,</span><span class="w"> </span><span class="n">border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"TopBottomLeftRight"</span><span class="p">,</span><span class="w"> </span><span class="n">halign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"center"</span><span class="p">,</span><span class="w"> </span><span class="n">textDecoration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bold"</span><span class="p">,</span><span class="w"> </span><span class="n">fontSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">)</span><span class="w">

</span><span class="n">addStyle</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="w"> </span><span class="n">sheet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sheet</span><span class="p">,</span><span class="w"> </span><span class="n">headerStyle</span><span class="p">,</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">gridExpand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1"># 加上filter</span><span class="w">
</span><span class="n">addFilter</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="w">

</span><span class="c1"># 寫檔</span><span class="w">
</span><span class="n">writeData</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="w"> </span><span class="n">sheet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sheet</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w">

</span><span class="c1"># 存檔</span><span class="w">
</span><span class="n">saveWorkbook</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="w"> </span><span class="s2">"file.xlsx"</span><span class="p">,</span><span class="w"> </span><span class="n">overwrite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="2xlconnect"><strong>(2)XLConnect</strong><br /></h3>
<p>至於XLConnect我是在想要使用資料驗證(data validation)裡的「清單」功能時想要克服的。</p>

<p>一開始想要直接使用openxlsx的dataValidation function，<br />
但一直失敗，且找到<a href="https://rdrr.io/cran/openxlsx/man/dataValidation.html">這裡</a>說明 list 這個功能無法發揮，<br />
所以我想到先儲存一個 template，將我需要的資料驗證清單做好，<br />
再使用 loadworkbook 的方法就可以保留 excel 裡原本的樣式。</p>

<p>原本是直接使用 openxlsx 這個 library 的 loadWorkbook，<br />
但在調整顏色時一直會有 error 無法解決，<br />
在改用 XLConnect 這個 library 後就成功使用我想要的cells style與保留資料驗證清單了。<br /></p>

<p>另外一個碰到的狀況是我也是要使用一份 template 的樣式，<br />
使用openxlsx和XLConnect的loadWorkbook時都遇到像這樣的錯誤</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error in substring(x[ind], so, eo) : 
  invalid multibyte string at '&lt;e6&gt;&lt;96&gt;&lt;b0&gt;蝝唳&lt;98&gt;&lt;ab&gt;&lt;94&gt;"/&gt;'
</code></pre></div></div>

<p>看起來像是編碼上的錯誤，但這份檔案上完全沒有中文，<br />
後來我甚至存一份空白的excel檔案都還是會有錯誤。</p>

<p>我將其他可以使用 loadWorkbook 這個 function 的 xlsx 丟進 Notepad++ 看，<br />
發現可以讀的檔案是<em>Macintosh(CR)</em></p>

<p><img src="http://localhost:4000/blog/img/Macintosh(CR).PNG" alt="Macintosh(CR).PNG" /></p>

<p>不能讀的檔案是<em>Unix(LF)</em></p>

<p><img src="http://localhost:4000/blog/img/Unix(LF).PNG" alt="Unix(LF).PNG" /></p>

<p>但是，將 template 儲存成 Macintosh(CR) 後，<br />
openxlsx的 loadWorkbook function 還是有同樣的 error，<br />
而 XLConnect 的錯誤則解除了。</p>

<p>程式碼範例，<br /></p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">XLConnect</span><span class="p">)</span><span class="w">

</span><span class="c1"># 讀取template</span><span class="w">
</span><span class="n">wb</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">loadWorkbook</span><span class="p">(</span><span class="s2">"file.xlsx"</span><span class="p">)</span><span class="w">

</span><span class="c1"># d是要儲存的dataframe，getSheets(wb)是sheet的名稱</span><span class="w">
</span><span class="n">writeWorksheet</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">getSheets</span><span class="p">(</span><span class="n">wb</span><span class="p">),</span><span class="w"> </span><span class="n">startRow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">startCol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="c1"># 設style</span><span class="w">
</span><span class="n">cs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">createCellStyle</span><span class="p">(</span><span class="n">wb</span><span class="p">)</span><span class="w">
</span><span class="c1"># 邊框</span><span class="w">
</span><span class="n">setBorder</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"all"</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XLC</span><span class="o">$</span><span class="s2">"BORDER.THIN"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">XLC</span><span class="o">$</span><span class="s2">"COLOR.BLACK"</span><span class="p">))</span><span class="w">
</span><span class="n">setCellStyle</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="w"> </span><span class="n">sheet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getSheets</span><span class="p">(</span><span class="n">wb</span><span class="p">),</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="o">:</span><span class="p">(</span><span class="m">7</span><span class="o">+</span><span class="n">nrow</span><span class="p">(</span><span class="n">d</span><span class="p">)),</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">cellstyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cs</span><span class="p">)</span><span class="w">

</span><span class="c1"># 存檔</span><span class="w">
</span><span class="n">saveWorkbook</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"savefile.xlsx"</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>

<h2 id="3xls">3.xls<br /></h2>
<p>xls用的是<a href="https://cran.r-project.org/web/packages/readxl/readxl.pdf">readxl</a>套件，是R界有名的ggplot2作者<a href="http://hadley.nz/">Hadley Wickham</a>所寫。<br /></p>

<p>下載完後只要一行指令就好，</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">readxl</span><span class="p">)</span><span class="w">
</span><span class="n">saleslead</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_excel</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">PATH</span><span class="p">,</span><span class="w"> </span><span class="s2">"2018 sales lead report (for TM only).xls"</span><span class="p">),</span><span class="w"> </span><span class="n">sheet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Raw Data"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>但要注意的是<a href="http://readxl.tidyverse.org/articles/cell-and-column-types.html#excel-types-r-types-col_types">屬性問題</a>。</p>

<p>其他更多 library 的 function 都可以去CRAN找哦！</p>
 -->
    <p>很多資料會使用excel檔案儲存，<br />
這邊介紹主要三種常用的附檔名。<br /></p>
<ol>
  <li>csv</li>
  <li>xlsx</li>
  <li>xls</li>
</ol>


    <div class="tags">

      <i class="far fa-tags"></i>
      <span>
        Tags :
      </span>
    </div>
    
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/blog/2018/02/26/R-%E4%BD%BF%E7%94%A8R%E5%AF%84Outlook-Email/">
        [R]使用 R 寄Outlook Email
      </a>
    </h1>

    <span class="post-date">Posted by Shihs on February 26, 2018</span>
    <!-- <p>之前有介紹過使用mailR這個套件夾帶檔案使用gmail信箱發送信件，<br />
<a href="https://shihs.github.io/blog/2016/07/17/R-%E4%BD%BF%E7%94%A8R%E7%99%BC%E9%80%81email/">看這裡</a>。</p>

<p>這篇要介紹使用RDOCOMClient這個套件來發送outlook夾帶檔案的電子郵件。<br />
<a href="https://stackoverflow.com/questions/26811679/sending-email-in-r-via-outlook">參考</a></p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">RDCOMClient</span><span class="p">)</span><span class="w">
</span><span class="c1">## init com api</span><span class="w">
</span><span class="n">OutApp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">COMCreate</span><span class="p">(</span><span class="s2">"Outlook.Application"</span><span class="p">)</span><span class="w">
</span><span class="c1">## create an email </span><span class="w">
</span><span class="n">outMail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OutApp</span><span class="o">$</span><span class="n">CreateItem</span><span class="p">(</span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="c1">## configure  email parameter </span><span class="w">
</span><span class="n">outMail</span><span class="p">[[</span><span class="s2">"To"</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"reciever@mail.com"</span><span class="w">
</span><span class="n">outMail</span><span class="p">[[</span><span class="s2">"subject"</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"subject"</span><span class="w">
</span><span class="c1"># There are two ways you can write for mail body</span><span class="w">
</span><span class="c1"># First:text</span><span class="w">
</span><span class="c1"># outMail[["body"]] = </span><span class="w">
</span><span class="c1"># "Dear reciever,</span><span class="w">
</span><span class="c1">#                      </span><span class="w">
</span><span class="c1"># Please see attached.</span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># </span><span class="w">
</span><span class="c1"># Best regards,</span><span class="w">
</span><span class="c1"># Sender"</span><span class="w">

</span><span class="c1"># Second:html text</span><span class="w">
</span><span class="n">body</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> 
</span><span class="s1">'
&lt;p&gt;Dear reciever,&lt;/p&gt;
&lt;p&gt;Please see attached.&lt;/p&gt;
&lt;br&gt;
&lt;br&gt;
&lt;p&gt;Best regards,
&lt;p&gt;Sender&lt;/p&gt;'</span><span class="w">

</span><span class="n">outMail</span><span class="p">[[</span><span class="s2">"HTMLbody"</span><span class="p">]]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">body</span><span class="w">

</span><span class="c1"># attachment</span><span class="w">
</span><span class="n">outMail</span><span class="p">[[</span><span class="s2">"Attachments"</span><span class="p">]]</span><span class="o">$</span><span class="n">Add</span><span class="p">(</span><span class="s2">"path of your attachment"</span><span class="p">)</span><span class="w">
</span><span class="c1">## send it                     </span><span class="w">
</span><span class="n">outMail</span><span class="o">$</span><span class="n">Send</span><span class="p">()</span><span class="w">


</span></code></pre></div></div>
 -->
    <p>之前有介紹過使用mailR這個套件夾帶檔案使用gmail信箱發送信件，<br />
<a href="https://shihs.github.io/blog/2016/07/17/R-%E4%BD%BF%E7%94%A8R%E7%99%BC%E9%80%81email/">看這裡</a>。</p>


    <div class="tags">

      <i class="far fa-tags"></i>
      <span>
        Tags :
      </span>
    </div>
    
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/blog/2018/02/17/Python-%E7%88%AC%E8%9F%B2-requests-%E7%9A%84%E7%B7%A8%E7%A2%BC/">
        [Python][爬蟲]requests 的編碼
      </a>
    </h1>

    <span class="post-date">Posted by Shihs on February 17, 2018</span>
    <!-- <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rep = requests.get(url)
</code></pre></div></div>
<p><strong>rep.content ： bytes 型別</strong></p>

<p><strong>rep.text    ： unicode 型別</strong><br />
1.是由 requests 以 rep.encoding 自動轉換的！<br />
2.rep.encoding 是以 Reponse Headers 的 Content-Type 決定！</p>

 -->
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rep = requests.get(url)
</code></pre></div></div>
<p><strong>rep.content ： bytes 型別</strong></p>


    <div class="tags">

      <i class="far fa-tags"></i>
      <span>
        Tags :
      </span>
    </div>
    
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/blog/2018/02/07/Python-%E7%88%AC%E8%9F%B2-%E9%98%B2%E6%AD%A2%E8%A2%ABban-%E4%BB%A3%E7%90%86IP%E6%80%8E%E9%BA%BC%E7%94%A8/">
        [Python][爬蟲]防止被ban，代理IP怎麼用?
      </a>
    </h1>

    <span class="post-date">Posted by Shihs on February 7, 2018</span>
    <!-- <h2 id="如何讓爬蟲程式不被ban"><strong>如何讓爬蟲程式不被ban?</strong></h2>
<ol>
  <li>動態設置user agent</li>
  <li>使用代理IP</li>
</ol>

<p><a href="http://willdrevo.com/using-a-proxy-with-a-randomized-user-agent-in-python-requests">參考</a><br />
這裡主要介紹如何使用IP代理。</p>

<h2 id="proxy代理類型"><strong>proxy代理類型</strong></h2>
<p><a href="http://gohom.win/2016/01/20/proxy-type/">參考</a></p>
<ol>
  <li>
    <p>透明代理(Transparent Proxy)<br />
REMOTE_ADDR = Proxy IP<br />
HTTP_VIA = Proxy IP<br />
HTTP_X_FORWARDED_FOR = Your IP</p>
  </li>
  <li>
    <p>匿名代理(Anonymous Proxy)<br />
REMOTE_ADDR = proxy IP<br />
HTTP_VIA = proxy IP<br />
HTTP_X_FORWARDED_FOR = proxy IP</p>
  </li>
  <li>
    <p>混淆代理(Distorting Proxies)<br />
REMOTE_ADDR = Proxy IP<br />
HTTP_VIA = Proxy IP<br />
HTTP_X_FORWARDED_FOR = Random IP address</p>
  </li>
  <li>
    <p>高匿代理(Elite proxy或High Anonymity Proxy)<br />
REMOTE_ADDR = Proxy IP<br />
HTTP_VIA = not determined<br />
HTTP_X_FORWARDED_FOR = not determined<br /></p>
  </li>
</ol>

<h2 id="代理proxy哪裡找"><strong>代理proxy哪裡找？</strong></h2>
<p>這裡提供兩個我覺得品質比較好的proxy代理<br /></p>
<ol>
  <li>http://www.goubanjia.com/free/index.shtml<br /></li>
  <li>http://www.proxyserverlist24.top/<br /></li>
</ol>

<p><a href="https://github.com/shihs/proxy/blob/master/get_proxies.py">程式碼</a></p>

<h2 id="如何確定真的使用代理ip了"><strong>如何確定真的使用代理IP了？</strong></h2>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>

<span class="c"># 隨便google可以找到可以查詢自己IP的網站</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">"http://icanhazip.com/"</span>  <span class="c"># 這個網站可以知道目前瀏覽的IP</span>
<span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">"http"</span><span class="p">:</span><span class="s">"http://xx.xx.xxx:xxxx"</span><span class="p">,</span>
	<span class="s">"https"</span><span class="p">:</span><span class="s">"https://xx.xx.xxx:xxxx"</span><span class="p">,</span>

<span class="p">}</span>
<span class="c">###注意</span>
<span class="c">#要爬取的網站是使用什麼協定？http？https？</span>
<span class="c">#網址可能會有轉址的情況，最後轉的那個網址才是真正的協定喔</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">proxies</span> <span class="o">=</span> <span class="n">proxies</span><span class="p">)</span>
<span class="k">print</span> <span class="n">res</span><span class="o">.</span><span class="n">text</span>  <span class="c"># 如果這個網站print出來的和proxies一樣，那就表示成功了</span>


</code></pre></div></div>

<p>抓完proxy後，我將所有proxy儲存在csv檔案中，
要爬取網站的時候，先讀取該檔案，
只要被擋，就random使用proxy替換proxies。</p>

<p>如果所有proxy都用完再重新爬取，
網站上的proxy都會不停更換，
所以只要更新proxy庫就好。</p>

 -->
    <h2 id="如何讓爬蟲程式不被ban"><strong>如何讓爬蟲程式不被ban?</strong></h2>
<ol>
  <li>動態設置user agent</li>
  <li>使用代理IP</li>
</ol>


    <div class="tags">

      <i class="far fa-tags"></i>
      <span>
        Tags :
      </span>
    </div>
    
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/blog/2018/02/02/Python-%E5%91%BC%E5%8F%AB%E5%85%B6%E4%BB%96py%E7%9A%84function/">
        [Python]呼叫其他.py的function
      </a>
    </h1>

    <span class="post-date">Posted by Shihs on February 2, 2018</span>
    <!-- <p>假如現在正在寫的檔案是main.py，而你想要呼叫fun.py這裡面的function，
要怎麼做呢？</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">### 這是fun.py</span>
<span class="k">def</span> <span class="nf">itsafunction</span><span class="p">():</span>
	<span class="k">print</span> <span class="s">"This is a function that I want to call."</span>

</code></pre></div></div>

<p>有兩種情況，<br />
<strong>1. 這兩個檔案在同一個folder底下</strong><br />
—main.py<br />
—fun.py<br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">### 這是 main.py</span>
<span class="kn">from</span> <span class="nn">fun</span> <span class="kn">import</span> <span class="n">itsafunction</span>

<span class="c"># 使用fun.py的itsafunction()</span>
<span class="n">itsafunction</span><span class="p">()</span>

</code></pre></div></div>

<p><strong>2. 這兩個檔案在不同folder底下</strong><br />
想要呼叫的fun.py在function這個folder底下<br />
—main.py<br />
—function—fun.py<br /></p>

<p>這時候main.py可以有兩種寫法</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">### 這是main1.py</span>
<span class="kn">from</span> <span class="nn">function</span> <span class="kn">import</span> <span class="n">fun</span>

<span class="c"># 使用fun.py的itsafunction()</span>
<span class="n">fun</span><span class="o">.</span><span class="n">itsafunction</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">### 這是main2.py</span>
<span class="kn">from</span> <span class="nn">function.fun</span> <span class="kn">import</span> <span class="n">itsafunction</span>

<span class="c"># 使用fun.py的itsafunction()</span>
<span class="n">itsafunction</span><span class="p">()</span>
</code></pre></div></div>

<p>但還有一件很重要的事，要<strong>在function這個folder裡加”__init__.py”這個檔案</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">### 這是__init___.py</span>
<span class="c"># 什麼都不用寫，沒錯，就是一個空白的.py檔</span>
<span class="c"># it's true, it's empty. But it's still important!</span>
</code></pre></div></div>

<p>那如果今天fun.py在function的下一層folder呢?<br />
—main.py<br />
—function—another—fun.py<br />
只要把main.py改成<br /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">### 這是main.py</span>
<span class="kn">from</span> <span class="nn">function.another</span> <span class="kn">import</span> <span class="n">fun</span>

<span class="c"># 使用fun.py的itsafunction()</span>
<span class="n">fun</span><span class="o">.</span><span class="n">itsafunction</span><span class="p">()</span>

<span class="c">#或者也可以這樣寫</span>

<span class="kn">from</span> <span class="nn">function.another.fun</span> <span class="kn">import</span> <span class="n">itsafunction</span>

<span class="c"># 使用fun.py的itsafunction()</span>
<span class="n">itsafunction</span><span class="p">()</span>
</code></pre></div></div>
<p>但最重要的是，<br />
<strong>function和another這兩個folder裡面都要加上”__init__.py”這個檔案!</strong></p>

 -->
    <p>假如現在正在寫的檔案是main.py，而你想要呼叫fun.py這裡面的function，
要怎麼做呢？</p>


    <div class="tags">

      <i class="far fa-tags"></i>
      <span>
        Tags :
      </span>
    </div>
    
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/blog/page2">Older</a>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>
    </div>

  </body>
</html>
